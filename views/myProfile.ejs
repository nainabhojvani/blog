<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head') %>
    <title>My Profile</title>
    <style>
      body {
        background: #f8f9fa;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
      }

      .profile-container {
        max-width: 1000px;
        margin: 40px auto;
        padding: 20px;
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 30px;
      }

      /* Left Section */
      .profile-card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }

      .profile-pic {
        width: 180px;
        height: 180px;
        border-radius: 50%;
        object-fit: cover;
        border: 5px solid #007bff;
        margin-bottom: 15px;
      }

      .profile-name {
        font-size: 1.8rem;
        font-weight: bold;
        margin: 5px 0;
      }

      .username {
        color: #6c757d;
        font-size: 0.95rem;
        margin-bottom: 15px;
      }

      .stats {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 15px;
      }

      .stats div {
        background: #f1f3f5;
        padding: 10px 15px;
        border-radius: 8px;
        min-width: 80px;
      }

      .stats h3 {
        color: #007bff;
        margin: 0;
        font-size: 1.3rem;
      }

      .stats p {
        margin: 0;
        font-size: 0.85rem;
        color: #555;
      }

      /* Right Section */
      .profile-details {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }

      .profile-section {
        margin-bottom: 25px;
      }

      .profile-section h2 {
        font-size: 1.2rem;
        border-bottom: 2px solid #f1f3f5;
        padding-bottom: 8px;
        margin-bottom: 15px;
      }

      .profile-info p {
        margin: 8px 0;
        color: #444;
      }

      /* Buttons */
      .btn {
        display: inline-block;
        padding: 8px 15px;
        border-radius: 8px;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
      }

      .btn-primary {
        background: #007bff;
        color: white;
      }
      .btn-primary:hover {
        background: #0056b3;
      }

      .btn-danger {
        background: #dc3545;
        color: white;
      }
      .btn-danger:hover {
        background: #b02a37;
      }

      /* Danger Zone */
      .danger-zone {
        border: 2px solid #f8d7da;
        background: #fef2f2;
        padding: 15px;
        border-radius: 10px;
      }

      .danger-zone h3 {
        color: #b02a37;
        margin-top: 0;
      }

      /* Popup Styling */
      .popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .popup.hidden {
        display: none;
      }
      .popup-content {
        background: white;
        padding: 25px;
        border-radius: 10px;
        width: 400px;
        max-width: 90%;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      }
      .popup-content h2 {
        margin-top: 0;
      }
      .popup-content input,
      .popup-content textarea {
        width: 100%;
        margin-bottom: 10px;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 6px;
      }
      .popup-content button {
        background: #007bff;
        color: white;
        padding: 8px 15px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
      .popup-content button:hover {
        background: #0056b3;
      }
    </style>
  </head>
  <body>
    <%- include('./partials/nav') %>

    <div class="profile-container">
      <!-- Left Profile Card -->
      <div class="profile-card">
        <img
          id="profile-img"
          src="<%= user.profileImage || '/images/default-avatar.png' %>"
          alt="Profile Picture"
          class="profile-pic"
        />
        <div class="profile-name"><%= user.name %></div>
        <div class="username">@<%= user.fullName %></div>

        <!-- Stats -->
        <div class="stats">
          <div>
            <h3><%= blogCount %></h3>
            <p>Blogs</p>
          </div>
          <div>
            <h3><%= commentCount %></h3>
            <p>Comments</p>
          </div>
        </div>
        
           <a
              class="btn btn-primary mt-4 px-4"
              href="/blog/add-new"
            >
              <i class="bi bi-pencil-square "></i> Write a Blog
            </a>
        
      </div>

      <!-- Right Profile Details -->
      <div class="profile-details">
        <!-- Info -->
        <div class="profile-section">
          <h2>Profile Information</h2>
          <div class="profile-info">
            <p><strong>Email:</strong> <%= user.email %></p>
            <p>
              <strong>Member Since:</strong> <%= user.createdAt ?
              user.createdAt.toDateString() : '' %>
            </p>
            <p>
              <strong>About Me:</strong> <%= user.bio || 'No bio added yet.' %>
            </p>
          </div>
        </div>

      <!-- Profile Actions -->
<div class="profile-section">
  <h2>Profile Actions</h2>
  <button id="edit-btn" type="button" class="btn btn-primary">
    <i class="bi bi-pencil-square"></i> Edit Profile
  </button>
  <a href="/blog/my" class="btn btn-primary">
    <i class="bi bi-journal-text"></i> My Blogs
  </a>
</div>

<!-- Danger Zone -->
<div class="profile-section danger-zone">
  <h3>Danger Zone</h3>
  <a href="/user/logout" class="btn btn-danger">
    <i class="bi bi-box-arrow-right"></i> Logout
  </a>
  <form
    action="/user/delete-account/<%= user._id %>"
    method="POST"
    onsubmit="return confirm('Are you sure you want to delete your account? This action cannot be undone.');"
    style="display:inline;"
  >
    <button type="submit" class="btn btn-danger">
      <i class="bi bi-trash"></i> Delete Account
    </button>
  </form>
</div>

    <!-- Popup Form -->
    <div id="edit-popup" class="popup hidden">
      <div class="popup-content">
        <h2>Edit Profile</h2>
        <form
          id="edit-form"
          action="/blog/update-profile"
          method="POST"
          enctype="multipart/form-data"
        >
          <label>Name:</label>
          <input type="text" name="fullName" value="<%= user.fullName %>" />

          <label>Email:</label>
          <input type="email" name="email" value="<%= user.email %>" />

          <label>Bio:</label>
          <textarea name="bio"><%= user.bio || '' %></textarea>

          <label>Profile Image:</label>
          <input type="file" name="profileImage" />

          <button type="submit">Save</button>
          <button type="button" id="close-popup">Cancel</button>
        </form>
      </div>
    </div>

    <%- include('./partials/scripts') %>
  </body>
</html>
